---
title: 接入工具
---

本文档将详细介绍如何在 Dify 平台接入不同类型的工具，包括插件、自定义工具、Workflow as Tool 和 MCP 服务器。

## 接入插件

插件是 Dify 生态系统中预构建的工具模块，提供了常用的 AI 能力扩展，如搜索、图像生成、数据分析等。

### 接入步骤

1. **访问插件市场**
   - 在 Dify 控制台右上角点击 "PLUGINS" 按钮
   - 浏览可用的插件列表

2. **安装插件**
   - 选择需要的插件，点击"安装"
   - 阅读插件说明和权限要求
   - 确认安装

3. **配置插件凭据**
   - 进入"工具"页面
   - 找到已安装的插件
   - 点击"配置"按钮
   - 输入所需的 API 密钥或凭据
   - 测试连接确保配置正确

4. **在应用中启用**
   - 创建或编辑智能助手应用
   - 在工具配置区域勾选已配置的插件
   - 保存应用设置

### 常见插件配置示例

**Google 搜索插件**
```
API Key: 从 Google Cloud Console 获取
搜索引擎 ID: 自定义搜索引擎的 ID
```

**DALL-E 图像生成**
```
OpenAI API Key: sk-xxxxxxxxxxxx
模型版本: dall-e-3
```

## 自定义工具接入

### 什么是自定义工具
自定义工具允许您将任何符合 OpenAPI 规范的 API 接入到 Dify 平台，实现与外部服务的集成。

### 准备工作

1. **准备 API 文档**
   - 确保 API 符合 OpenAPI 3.0+ 规范
   - 或准备 OpenAI Plugin 格式的描述文件
   - 包含完整的接口定义、参数说明和响应格式

2. **获取访问凭据**
   - API Key
   - OAuth 令牌
   - 其他认证信息

### 接入步骤

1. **创建自定义工具**
   ```
   导航路径：工具 > Custom > Create Custom Tool
   ```

2. **导入 API 规范**
   
   **方式一：直接粘贴**
   ```yaml
   openapi: 3.0.0
   info:
     title: 天气查询 API
     version: 1.0.0
   paths:
     /weather:
       get:
         summary: 获取天气信息
         parameters:
           - name: city
             in: query
             required: true
             schema:
               type: string
   ```

   **方式二：URL 导入**
   ```
   输入 URL: https://api.example.com/openapi.json
   点击"导入"按钮
   ```

3. **配置基本信息**
   - 工具名称：简洁明了的名称
   - 工具描述：说明工具的功能和使用场景
   - 图标：选择合适的图标便于识别

4. **设置鉴权方式**
   
   **无鉴权**
   - 适用于公开 API
   - 无需额外配置

   **API Key 鉴权**
   - Header 名称：`Authorization`
   - Key 格式：`Bearer {api_key}`
   - 配置示例：
     ```
     Authorization: Bearer sk-xxxxxxxxxxxx
     ```

5. **参数映射和测试**
   - 检查自动解析的参数
   - 修正参数类型和描述
   - 使用测试功能验证接口
   - 确认返回数据格式正确

6. **保存并发布**
   - 点击"保存"完成工具创建
   - 工具自动在工作区内可用

### 高级配置

**请求拦截器**
```javascript
// 在请求发送前修改参数
function beforeRequest(params) {
  params.headers['X-Custom-Header'] = 'value';
  return params;
}
```

**响应处理器**
```javascript
// 处理返回数据格式
function afterResponse(response) {
  return {
    status: response.status,
    data: response.data.result
  };
}
```

### 最佳实践

1. **API 设计规范**
   - 使用 RESTful 风格
   - 提供清晰的错误码
   - 返回结构化的 JSON 数据

2. **文档完整性**
   - 包含所有必需参数
   - 提供示例请求和响应
   - 说明限制和约束条件

3. **错误处理**
   - 定义明确的错误响应格式
   - 提供有意义的错误信息
   - 实现重试机制

## Workflow as Tool 接入

### 什么是 Workflow as Tool
将 Dify 中创建的工作流封装成工具，可以在其他应用中复用复杂的业务逻辑。

### 准备工作

1. **创建工作流**
   - 在工作流编辑器中设计流程
   - 定义输入和输出参数
   - 测试工作流确保正常运行

2. **参数规范化**
   - 明确定义输入参数类型
   - 设置参数验证规则
   - 规范输出数据格式

### 接入步骤

1. **工作流发布**
   ```
   工作流编辑器 > 发布 > 设置版本号
   ```

2. **启用为工具**
   - 进入"工具"页面
   - 切换到"Workflow"标签
   - 找到目标工作流
   - 点击"启用为工具"

3. **配置工具属性**
   - 工具名称：描述性的名称
   - 工具描述：说明工具的功能
   - 参数映射：确认输入输出参数

4. **设置调用权限**
   - 选择可以使用此工具的应用类型
   - 配置调用频率限制
   - 设置超时时间

5. **集成到应用**
   - 在智能助手应用中添加此工具
   - 配置触发条件
   - 测试工具调用

### 示例：创建数据处理工具

**工作流设计**
```
输入节点 -> 数据清洗 -> 格式转换 -> 计算分析 -> 输出节点
```

**参数定义**
```yaml
inputs:
  - name: raw_data
    type: string
    description: 原始数据
  - name: format
    type: string
    enum: ["json", "csv", "xml"]
    
outputs:
  - name: processed_data
    type: object
    description: 处理后的数据
  - name: summary
    type: string
    description: 数据摘要
```

**工具配置**
```
名称：数据处理助手
描述：自动清洗、转换和分析数据
超时：30秒
并发限制：5
```

### 调试和优化

1. **日志记录**
   - 在工作流中添加日志节点
   - 记录关键步骤的执行状态
   - 便于问题排查

2. **错误处理**
   - 添加异常捕获节点
   - 设置默认返回值
   - 提供友好的错误提示

3. **性能优化**
   - 使用缓存节点减少重复计算
   - 并行执行独立的任务
   - 设置合理的超时时间

## 工具接入后的管理

### 监控和维护

1. **使用统计**
   - 查看调用次数
   - 分析成功率
   - 监控响应时间

2. **版本管理**
   - 保持 API 兼容性
   - 记录变更日志
   - 平滑升级策略

3. **权限控制**
   - 按团队分配工具权限
   - 设置调用配额
   - 审计使用记录

### 故障处理

**常见问题排查清单**

1. **连接失败**
   - 检查网络连通性
   - 验证 API 地址
   - 确认防火墙设置

2. **认证错误**
   - 核对 API 密钥
   - 检查密钥有效期
   - 确认权限范围

3. **数据异常**
   - 验证请求参数格式
   - 检查响应数据结构
   - 确认编码格式

4. **性能问题**
   - 优化 API 响应时间
   - 增加缓存策略
   - 实施限流措施

## 下一步

- 查看[工具开发指南](/zh-hans/guides/tools/tool-development)深入了解工具开发
- 参考[最佳实践](/zh-hans/guides/tools/best-practices)优化工具使用
- 访问[API 文档](/zh-hans/api-reference)了解更多技术细节

{/*
Contributing Section
DO NOT edit this section!
It will be automatically generated by the script.
*/}

<CardGroup cols="2">
    <Card
        title="编辑此页面"
        icon="pen-to-square"
        href="https://github.com/langgenius/dify-docs-mintlify/edit/main/zh-hans/guides/tools/integrate-tool.mdx"
    >
        通过直接提交修改来帮助改进文档内容
    </Card>
    <Card
        title="提交问题"
        icon="github"
        href="https://github.com/langgenius/dify-docs-mintlify/issues/new?title=文档问题%3A%20&body=%23%23%20问题描述%0A%3C%21--%20请简要描述您发现的问题%20--%3E%0A%0A%23%23%20页面链接%0Ahttps%3A%2F%2Fgithub.com%2Flanggenius%2Fdify-docs-mintlify%2Fblob%2Fmain%2Fzh-hans/guides/tools%2Fintegrate-tool.mdx%0A%0A%23%23%20建议修改%0A%3C%21--%20如果有具体的修改建议，请在此说明%20--%3E%0A%0A%3C%21--%20感谢您对文档质量的关注！%20--%3E"
    >
        发现错误或有改进建议？请提交问题反馈
    </Card>
</CardGroup>
